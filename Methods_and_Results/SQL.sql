-- How many Products does the company have?
SELECT Product_type,
    COUNT(Product_type) AS Number_of_Products,
    ROUND(AVG(Price), 2) AS Average_Price
FROM Data_Source
GROUP BY Product_type
ORDER BY 2 DESC;

-- What are the top 10 products by total quantities sold?
SELECT Product_Type,
    SKU,
    SUM(Order_Quantities) AS '# of Orders'
FROM Data_Source
GROUP BY Product_Type, SKU
ORDER BY 3 DESC
LIMIT 10;

-- What are the least 10 products by total quantities sold?
SELECT Product_Type,
    SKU,
    SUM(Order_Quantities) AS '# of Orders'
FROM Data_Source
GROUP BY Product_Type, SKU
ORDER BY 3 ASC
LIMIT 10;

-- Sum of sales for each location 
SELECT Location,
    Product_type,
    ROUND(SUM(Revenue_generated), 2) AS Total_Revenue,
    SUM(Order_Quantities) AS '# of Orders'
FROM Data_Source
GROUP BY Location, Product_type
ORDER BY Total_Revenue DESC;

-- Supply Chain Analysis

-- Average lead time for each supplier
SELECT Supplier_Name,
    ROUND(AVG(Lead_Times), 2) AS Average_Lead_Times,
    ROUND(AVG(Lead_Time), 2) AS Average_Lead_Time
FROM Data_Source
GROUP BY Supplier_Name
ORDER BY Supplier_Name;

-- Sum of revenue generated by product type
SELECT Product_Type,
    ROUND(SUM(Revenue_generated), 2) AS Total_Revenue,
    ROUND(SUM(Revenue_Generated) - SUM(Costs), 2) AS Profit,
    ROUND(SUM(Revenue_generated) - (SUM(Revenue_Generated) - SUM(Costs)), 2) AS 'Revenue - Costs',
    ROUND(SUM(Revenue_generated) / SUM(Number_Of_Products_Sold), 2) AS 'Revenue per Product',
    SUM(Number_Of_Products_Sold) AS '# of Products Sold',
    SUM(Order_Quantities) AS '# of Orders'
FROM Data_Source
GROUP BY Product_Type
ORDER BY Total_Revenue DESC;

-- Top 10 products by profit
SELECT SKU,
    Product_Type,
    Revenue_generated - Costs AS Profit
FROM Data_Source
ORDER BY Profit DESC
LIMIT 10;

-- Product type with the highest average lead time
SELECT 
    Product_type,
    AVG(Lead_Times) AS Average_Lead_Time,
    AVG(Stock_Levels) AS Average_Stock_Level,
    AVG(Availability) AS Average_Availability
FROM Data_Source
GROUP BY Product_type
ORDER BY 2 DESC;

-- Transportation and routes with the highest average lead time and average costs
SELECT Transportation_Modes AS Transportation,
    Routes,
    ROUND(AVG(Lead_Times), 2) AS Average_Lead_Time,
    ROUND(AVG(Costs), 2) AS Average_Costs
FROM Data_Source
GROUP BY Transportation_Modes, Routes
ORDER BY 3 ASC, 1, 2;

-- Suppliers Inspection Results
SELECT Supplier_Name,
    SUM(Pass) AS Pass,
    SUM(Fail) AS Fail,
    SUM(Pending) AS Pending,
    SUM(Pass) + SUM(Fail) + SUM(Pending) AS Total_Inspections,
    ROUND(SUM(Pass) / (SUM(Pass) + SUM(Fail) + SUM(Pending)) * 100, 2) AS Pass_Percentage,
    ROUND(SUM(Fail) / (SUM(Pass) + SUM(Fail) + SUM(Pending)) * 100, 2) AS Fail_Percentage,
    ROUND(SUM(Pending) / (SUM(Pass) + SUM(Fail) + SUM(Pending)) * 100, 2) AS Pending_Percentage
FROM (
    SELECT Supplier_Name,
        Inspection_Results,
        CASE
            WHEN Inspection_Results = 'Pass' THEN 1
            ELSE 0
        END AS Pass,
        CASE
            WHEN Inspection_Results = 'Fail' THEN 1
            ELSE 0
        END AS Fail,
        CASE
            WHEN Inspection_Results = 'Pending' THEN 1
            ELSE 0
        END AS Pending
    FROM Data_Source
) AS subquery
GROUP BY Supplier_Name
ORDER BY Supplier_Name;